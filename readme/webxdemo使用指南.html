<!DOCTYPE html><html><head><title>webxdemo使用指南</title><meta charset='utf-8'><link href='https://dn-maxiang.qbox.me/res-min/themes/marxico.css' rel='stylesheet'><style></style></head><body><div id='preview-contents' class='note-content'>
                        <div id="wmd-preview" class="preview-content"></div>
                    <div id="wmd-preview-section-8633" class="wmd-preview-section preview-content">

</div><div id="wmd-preview-section-9467" class="wmd-preview-section preview-content">

<h1 id="webxdemo使用指南">webxdemo使用指南</h1>

<p><code>webx学习指南</code>请移步到<a href="https://github.com/xiaoMzjm/webxdemo/blob/zjm-fix-bug-branch/readme/how-to-learn-webx.md" target="_blank">这里</a></p></div><div id="wmd-preview-section-8635" class="wmd-preview-section preview-content">

<h3 id="一-快速运行项目-1">一 快速运行项目</h3>

</div><div id="wmd-preview-section-8636" class="wmd-preview-section preview-content">

<h4 id="11-一个可行的开发环境-1">1.1 一个可行的开发环境</h4>

<blockquote>
  <p>语言：<code>jdk1.7</code><br>
  IDE：<code>eclipse ee luna 4.4.2</code><br>
  版本控制：<code>git preview 1.9.5</code><br>
  项目管理：<code>maven 3.3.9</code><br></p>
</blockquote>

</div><div id="wmd-preview-section-8637" class="wmd-preview-section preview-content">

<h4 id="12-克隆项目-1">1.2 克隆项目</h4>

</div><div id="wmd-preview-section-8638" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs crmsh">git <span class="hljs-keyword">clone</span> <span class="hljs-title">https</span>://github.com/xiaoMzjm/webxdemo.git<br></code></pre>

</div><div id="wmd-preview-section-8639" class="wmd-preview-section preview-content">

<h4 id="13-手动导入maven仓库没有的jar包-1">1.3 手动导入maven仓库没有的jar包</h4>

<blockquote>
  <p>proxool下载地址：<a href="https://sourceforge.net/projects/proxool/files/proxool/0.9.1/proxool-0.9.1.zip/download?use_mirror=heanet&amp;download=" target="_blank">proxool-0.9.1</a><br></p>
</blockquote>

</div><div id="wmd-preview-section-8640" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs cpp">mvn install:install-file -Dfile=proxool-<span class="hljs-number">0.9</span><span class="hljs-number">.1</span>.jar -DgroupId=proxool -DartifactId=proxool -Dversion=<span class="hljs-number">0.9</span><span class="hljs-number">.1</span> -Dpackaging=jar<br></code></pre>

</div><div id="wmd-preview-section-8641" class="wmd-preview-section preview-content">

<h4 id="14-eclipse导入项目-1">1.4 eclipse导入项目</h4>

<blockquote>
  <p>按提示解决可能出现的错误<br></p>
</blockquote>

</div><div id="wmd-preview-section-8642" class="wmd-preview-section preview-content">

<h4 id="15-运行-1">1.5 运行</h4>

</div><div id="wmd-preview-section-8643" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs applescript">mvn clean tomcat:<span class="hljs-command">run</span><br></code></pre>

</div><div id="wmd-preview-section-8644" class="wmd-preview-section preview-content">

<h4 id="16-测试-1">1.6 测试</h4>

<blockquote>
  <p>浏览器输入<code>http://localhost:8080/topview/captcha/captcha.do</code>(本框架集成的验证码组件的demo地址)，假如出现一个验证码图形，则代表项目正常运行。</p>
</blockquote>

<p><br></p>

</div><div id="wmd-preview-section-8645" class="wmd-preview-section preview-content">

<h3 id="二-集成工具类engine篇-1">二 集成工具类（engine篇）</h3>

<p>以下工具，在<code>web子项目</code>的<code>src/test/java</code>目录下对应的包中都能找到<code>UseCase类</code>，里面有对应工具的<code>使用方法</code>。为什么engine子项目的测试用例写在web子项目下而不是engine下，是因为spring配置文件放在web子项目中，只有在web子项目才能结合spring+junit跑起来<br>
<br></p>

</div><div id="wmd-preview-section-8646" class="wmd-preview-section preview-content">

<h4 id="21-http工具-1">2.1 Http工具</h4>

<p><strong>简介</strong>：<br></p>

<blockquote>
  <p>基于<code>HttpClient4.5</code> 的封装，支持基于get和post的基本的、带参数的、带文件的HTTP、HTTPS请求等功能。<br></p>
</blockquote>

<p><strong>注意事项</strong>：<br></p>

<blockquote>
  <p>使用前建议根据业务修改web子项目的biz-engine.xml文件，修改<code>连接池</code>，<code>请求超时</code>等相关参数。<br></p>
</blockquote>

</div><div id="wmd-preview-section-8647" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs xml">    <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"httpClientFactory"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"com.alibaba.webx.searchengine.factory.http.HttpClientFactory"</span> <span class="hljs-attribute">init-method</span>=<span class="hljs-value">"init"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"maxConnectionNum"</span>&gt;</span>              <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>           <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 最大连接数限制 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"maxGetConnectionTimeOut"</span>&gt;</span>       <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>5000<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>         <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 最大获取连接超时限制 ，单位毫秒--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"maxRouteConnectionNum"</span>&gt;</span>         <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>           <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 每个路由最大的连接数限制 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"maxLastConnectionTimeOut"</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>10000<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 每个请求连接最长时间限制 ，单位毫秒--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"maxGetDataTimeOut"</span>&gt;</span>             <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>5000<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>         <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 获取数据最长时间限制，单位毫秒 --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span><br></code></pre>

<blockquote>
  <p>若要使用<code>https</code>请求，必须加上<code>vm参数</code>：-Djsse.enableSNIExtension=false，否者报错javax.net.ssl.SSLProtocolException: handshake alert: unrecognized_name，原因请见<a href="http://stackoverflow.com/questions/7615645/ssl-handshake-alert-unrecognized-name-error-since-upgrade-to-java-1-7-0" target="_blank">这里</a>。<br></p>
</blockquote>

<p><br></p>

</div><div id="wmd-preview-section-8648" class="wmd-preview-section preview-content">

<h4 id="22-mail工具-1">2.2 mail工具</h4>

<p><strong>简介</strong>：<br></p>

<blockquote>
  <p>基于<code>javax.mail1.4.7</code>的封装，支持<code>群发</code>带<code>附件</code>的<code>HTML</code>格式的邮件等基本功能。<br></p>
</blockquote>

<p><strong>注意事项</strong>：<br></p>

<blockquote>
  <p>使用前必须修改web子项目的biz-engine.xml文件，修改用来发送邮件的<code>邮箱以及密码</code>，用来发送的邮箱建议使用<code>QQ邮箱</code>，网易邮箱容易被当成垃圾邮件发不出去。</p>
</blockquote>

</div><div id="wmd-preview-section-8649" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs xml">    <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mailFactory"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"com.alibaba.webx.searchengine.factory.mail.MailFactory"</span> <span class="hljs-attribute">init-method</span>=<span class="hljs-value">"init"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"defaultMailServerHost"</span>&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>smtp.qq.com<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 邮件服务地址 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"defaultMailServerPort"</span>&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>25<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>               <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 端口号 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"defaultSenderAddress"</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>xxxxxxxxx<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 用来发送邮件的账号 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"defaultPassword"</span>&gt;</span>           <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>xxxxxx<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>           <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 账号对应的密码 --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span><br></code></pre>

<p><br></p>

</div><div id="wmd-preview-section-8650" class="wmd-preview-section preview-content">

<h4 id="23-mybatis工具-1">2.3 mybatis工具</h4>

<p><strong>简介</strong>：<br></p>

<blockquote>
  <p>基于mybatis-spring、proxool、proxool-cglib的封装，支持<code>多源</code>数据库的Session的获取。方便在没使用数据库中间件时，实现读写分离。<br></p>
</blockquote>

<p><strong>注意事项</strong>：<br></p>

<blockquote>
  <p>使用前必须修改web子项目的biz-engine.xml文件，修改与<code>数据库连接</code>相关的参数以及<code>连接池</code>相关的参数。</p>
</blockquote>

</div><div id="wmd-preview-section-8651" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs xml">    <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"dataSourceRW"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.logicalcobwebs.proxool.ProxoolDataSource"</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"alias"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"ReadWriteDataBase"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"delegateProperties"</span>&gt;</span>  <br>            <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>user=root,password=root<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"user"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"root"</span> /&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"password"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"root"</span> /&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"driver"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"com.mysql.jdbc.Driver"</span> /&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"driverUrl"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"jdbc:mysql://localhost:3306/test"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"minimumConnectionCount"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"5"</span> /&gt;</span>                            <span class="hljs-comment">&lt;!-- 确定池中最小连接数 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"houseKeepingTestSql"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"select user from mysql.user"</span> /&gt;</span>     <span class="hljs-comment">&lt;!-- 确定保证连接可能的定时查询SQL --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"testBeforeUse"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"true"</span> /&gt;</span>                                  <span class="hljs-comment">&lt;!-- 检测连接是否可以用，没用的话就换条连接 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"maximumActiveTime"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"5"</span> /&gt;</span>                                 <span class="hljs-comment">&lt;!-- 确定连接的最大持续使用时间，超时断开，单位为分钟 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"prototypeCount"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"2"</span> /&gt;</span>                                    <span class="hljs-comment">&lt;!-- 确定该连接被使用后，池中还有多少空闲连接，是否得重新创建新的备用，需要的话要创建多少个 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"maximumConnectionLifetime"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"4"</span> /&gt;</span>                         <span class="hljs-comment">&lt;!-- 确定在连接数大于最小连接数时，多出的空闲连接多久被杀死，单位为小时 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"maximumConnectionCount"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"15"</span> /&gt;</span>                           <span class="hljs-comment">&lt;!-- 确定一个阀门，规定池中最大连接数 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">prope</span></span><br></code></pre>

<p><br></p>

</div><div id="wmd-preview-section-8652" class="wmd-preview-section preview-content">

<h4 id="24-redis工具-1">2.4 redis工具</h4>

<p><strong>简介</strong>：<br></p>

<blockquote>
  <p>基于jedis的封装，从<code>连接池</code>从获取jedis对象。<br></p>
</blockquote>

<p><strong>注意事项</strong>：<br></p>

<blockquote>
  <p>使用前必须修改web子项目的biz-engine.xml文件，修改<code>数据库IP、端口、密码，连接池的最大连接数、连接等待时间，连接超时时间</code>等参数。</p>
</blockquote>

</div><div id="wmd-preview-section-8653" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs xml">    <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"redisFactory"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"com.alibaba.webx.searchengine.factory.redis.RedisFactory"</span> <span class="hljs-attribute">init-method</span>=<span class="hljs-value">"init"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"poolMaxIdel"</span>&gt;</span>           <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>                <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 控制一个pool最多有多少个状态为idle(空闲的)的jedis实例 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"poolMaxWaitMillis"</span>&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>5000<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>             <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 获取连接时的最大等待时间，单位毫秒 ,默认值为-1，表示永不超时 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"poolTestOnBorrow"</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>             <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 是否在获取连接的时候检查有效性, 默认false --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"poolIp"</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>              <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 数据库的地址 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"poolPort"</span>&gt;</span>              <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>6379<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>             <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 数据库的端口 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"poolConnectTimeOut"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>5000<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>             <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 连接持续连接的超时时间，单位毫秒--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"poolPassword"</span>&gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>xxxxxxxx<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>         <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 数据库密码 --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span><br></code></pre>

<p><br></p>

</div><div id="wmd-preview-section-8654" class="wmd-preview-section preview-content">

<h4 id="25-邮件日志组件-1">2.5 邮件日志组件</h4>

<p><strong>简介</strong>：<br></p>

<blockquote>
  <p>在<code>try-catch</code>中，使用邮件日志组件把catch到的Exception传到邮件队列中，邮件日志组件会定时把队列中的错误信息发到指定的邮箱。在没有<code>日志管理分析</code>工具的情况下，使用该组件可以及时发现错误。<br></p>
</blockquote>

</div><div id="wmd-preview-section-8655" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs cpp"><span class="hljs-keyword">try</span> {<br>    <span class="hljs-keyword">int</span> num = <span class="hljs-number">5</span> / <span class="hljs-number">0</span>;<br>} <span class="hljs-keyword">catch</span> (Exception e) {<br>    loggerUtils.emailError(e);<br>}<br></code></pre>

<p><strong>注意事项</strong>：<br></p>

<blockquote>
  <p>使用前必须修改web子项目的biz-engine.xml文件，设置接收邮件的<code>邮箱，邮件标题，用来发送邮件的线程池的大小，发送邮件的时间间隔</code>等参数。<br></p>
</blockquote>

</div><div id="wmd-preview-section-8656" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs xml">    <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"loggerUtils"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"com.alibaba.webx.searchengine.util.log.LoggerUtils"</span>  <span class="hljs-attribute">init-method</span>=<span class="hljs-value">"init"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"acceptorList"</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>xxx@163.com<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>          <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 要把错误推送给哪些邮箱 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"emailTitle"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>XXX项目错误日志推送<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 邮件标题 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"threadNum"</span>&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>                   <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 用来发邮件的线程数 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"sendEmailRate"</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>20<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>                   <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 多少秒发一次邮件 --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span><br></code></pre>

<p><br></p>

</div><div id="wmd-preview-section-8657" class="wmd-preview-section preview-content">

<h4 id="26-验证码组件-1">2.6 验证码组件</h4>

<p><strong>简介</strong>：<br></p>

<blockquote>
  <p>基于<code>jcaptcha</code>的封装，写好了一个获取验证码的接口，客户端可以直接访问该接口获得验证码，后台可以通过一句代码验证验证码正确与否。并且<code>重写</code>了验证码的存储逻辑，为验证码分布式存储提供了可能（但没实现<code>分布式验证码</code>，因为若使用ip_hash的负载均衡策略，不实现分布式验证码也可以，如果要实现，请自己做二次开发）。<br></p>
</blockquote>

<p><strong>注意事项</strong>：<br></p>

<blockquote>
  <p>验证码样式类位置在：web子项目的com.alibaba.webx.web.module.screen.captcha包下的MyCaptchaEngine类，若要重新修改<code>样式</code>(比如字体大小，背景，干扰项等等)，可以修改该类的属性值。<br></p>
</blockquote>

<p><br></p>

</div><div id="wmd-preview-section-8658" class="wmd-preview-section preview-content">

<h3 id="三-集成工具类coomon篇-1">三 集成工具类（coomon篇）</h3>

<p><code>以下工具，在各自的包的下面都有一个UseCase类，里面有对应组件的使用方法。</code><br>
<br></p>

</div><div id="wmd-preview-section-8659" class="wmd-preview-section preview-content">

<h4 id="31-日期工具-1">3.1 日期工具</h4>

<blockquote>
  <p>使用日期工具，可以方便地获取当天日期和<code>前后N天</code>的日期（Date、String、Long格式），也可以方便地对<code>Date、String、Long</code>三种格式的日期进行互相转化。<br></p>
</blockquote>

<p><br></p>

</div><div id="wmd-preview-section-8660" class="wmd-preview-section preview-content">

<h4 id="32-excel工具-1">3.2 excel工具</h4>

<blockquote>
  <p>基于<code>jxl</code>的封装，使用excel工具，可以方便地对excel进行读写操作。内定了比较好看的基本样式，包括颜色，边框等等。当然也可以自己修改样式。<br></p>
</blockquote>

<p><br></p>

</div><div id="wmd-preview-section-8661" class="wmd-preview-section preview-content">

<h4 id="33-image工具-1">3.3 image工具</h4>

<blockquote>
  <p>使用image工具，可以方便地对图片进行操作。例如<code>裁剪、缩小放大、图片拼接、图像合并、去色、水印、画图</code>等等。常用的做法是用来对用户上传的图片进行<code>压缩</code>。<br></p>
</blockquote>

<p><br></p>

</div><div id="wmd-preview-section-8662" class="wmd-preview-section preview-content">

<h4 id="34-md5工具-1">3.4 MD5工具</h4>

<blockquote>
  <p>使用MD5工具，可以方便地进行MD5加密。<br></p>
</blockquote>

<p><br></p>

</div><div id="wmd-preview-section-8663" class="wmd-preview-section preview-content">

<h4 id="35-word工具-1">3.5、 word工具</h4>

<blockquote>
  <p>基于<code>poi</code>的封装，使用word工具，可以方便地进行word的操作。例如写入文字/图片，替换模板占位符，word转HTML等操作。<br></p>
</blockquote>

<p><br></p>

</div><div id="wmd-preview-section-8664" class="wmd-preview-section preview-content">

<h4 id="36-微信验证工具-1">3.6 微信验证工具</h4>

<blockquote>
  <p>使用微信工具，可以方便地验证访问者，判断是否是来自微信后台的请求。也可以通过该工具，和APP端约定好使用相同的算法做数字请求的数字签名，验证请求者的身份。<br></p>
</blockquote>

<p><code>注意事项</code>:<br></p>

<blockquote>
  <p>使用前必须修改web子项目的biz-common.xml文件，设置公众号的token（密钥）<br></p>
</blockquote>

</div><div id="wmd-preview-section-8665" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs xml">    <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"signUtil"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"com.alibaba.webx.common.util.weixin.WeCharSignUtil"</span> &gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"token"</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 公众号token --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span><br></code></pre>

<p><br></p>

</div><div id="wmd-preview-section-8666" class="wmd-preview-section preview-content">

<h4 id="37-开关工具-1">3.7 开关工具</h4>

<blockquote>
  <p>使用开关工具，在编写一些新功能时，可以在代码的最前方加入开关，以便一键开启/关闭新功能。假如一个功能上线后出了问题，导致其他服务受到影响，如果关闭服务器修复，肯定会影响到用户的正常使用，不修复的话用户又访问不了，有了开关工具后，此时我们可以在<code>redis数据库</code>中把开关关闭，即可停掉该功能，这样的话可以保证其他服务正常运行。开关的的获取会从<code>本地</code>和<code>默认redis数据库</code>中获取，当从redis获取失败时，自动从本地获取，方便没配redis的用户使用。 但没配redis的用户将使用不了从数据库控制开关的功能。<br></p>
</blockquote>

<p><strong>注意事项</strong>：<br></p>

<blockquote>
  <p>使用前必须修改web子项目的biz-engine.xml文件，配置某个功能<code>开或关</code>。<br></p>
</blockquote>

</div><div id="wmd-preview-section-8667" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="hljs xml">    <span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"mySwitchUtil"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"com.alibaba.webx.searchengine.util.switchs.MySwitchUtil"</span> <span class="hljs-attribute">init-method</span>=<span class="hljs-value">"init"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"EMAIL_LOG_SWITCH"</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>     <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span> <span class="hljs-comment">&lt;!-- 邮件日志功能开关 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"DEMO_SWITCH"</span>&gt;</span>       <span class="hljs-tag">&lt;<span class="hljs-title">value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-title">value</span>&gt;</span>     <span class="hljs-tag">&lt;/<span class="hljs-title">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span><br></code></pre>

<p><br></p>

</div><div id="wmd-preview-section-8668" class="wmd-preview-section preview-content">

<h3 id="四-开发规范与约定-1">四 开发规范与约定</h3>

</div><div id="wmd-preview-section-8669" class="wmd-preview-section preview-content">

<h4 id="41-json-1">4.1  json</h4>

<blockquote>
  <p>使用<code>fastjson</code>进行json序列化，例如：<br></p>
</blockquote>

</div><div id="wmd-preview-section-8670" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="language-java hljs">String jsonStr = JSON.toJSONString(object);<br></code></pre>

<p><br></p>

</div><div id="wmd-preview-section-8671" class="wmd-preview-section preview-content">

<h4 id="42-字符串集合-1">4.2 字符串、集合</h4>

<p>使用<code>org.apache.commons-commons-lang</code>3和<code>commons-collections</code><br>
例如字符串判空：<code>StringUtils.isBlank(str);</code><br>
例如集合判空：<code>CollectionUtils.isEmpty(collection);</code><br></p>

<p><br></p>

</div><div id="wmd-preview-section-8672" class="wmd-preview-section preview-content">

<h4 id="43-内存缓存-1">4.3 内存缓存</h4>

<blockquote>
  <p>使用<code>com.google.guava-guava</code>做缓存，例子位于service子项目的com.alibaba.webx.service.demo.impl包的<code>ServiceDemoImpl</code>类。<br></p>
</blockquote>

<p><br></p>

</div><div id="wmd-preview-section-8673" class="wmd-preview-section preview-content">

<h4 id="44-对象池-1">4.4 对象池</h4>

<blockquote>
  <p>使用commons-pool做对象池。<br></p>
</blockquote>

<p><br></p>

</div><div id="wmd-preview-section-8674" class="wmd-preview-section preview-content">

<h4 id="45-下传下载写法-1">4.5 下传下载写法</h4>

<blockquote>
  <p>上传下载的写法在web子项目的com.alibaba.webx.web.module.screen.demo包下的<code>ScreenDemo</code>类，可以参考其写法。</p>
</blockquote>

<p><br></p>

</div><div id="wmd-preview-section-8675" class="wmd-preview-section preview-content">

<h4 id="46-spring获取对象-1">4.6 spring获取对象</h4>

<blockquote>
  <p>那些在spring配置文件里面配置的bean（例如上面提到的各种组件及工具），请用@Autowired获取，不要用new，避免一些应该被初始化的参数没被初始化。</p>
</blockquote>

</div><div id="wmd-preview-section-8676" class="wmd-preview-section preview-content"></div><div id="wmd-preview-section-footnotes" class="preview-content"></div></div></body></html>